<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>WalletWhiz - Powered by BHV Technologies</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --primary: #6366f1;
      --accent: #10b981;
      --bg: #f6f7fb;
      --card: #fff;
      --text: #222;
      --muted: #6b7280;
      --danger: #ef4444;
      --shadow: 0 4px 24px #6366f11a;
    }
    [data-theme="dark"] {
      --primary: #818cf8;
      --accent: #34d399;
      --bg: #18181b;
      --card: #232336;
      --text: #f3f4f6;
      --muted: #a1a1aa;
      --danger: #f87171;
      --shadow: 0 4px 24px #22223a66;
    }
    html, body {
      background: var(--bg);
      color: var(--text);
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', Arial, sans-serif;
      min-height: 100vh;
      -webkit-tap-highlight-color: transparent;
      position: relative;
    }
    .app-container {
      max-width: 430px;
      margin: 0 auto;
      background: var(--bg);
      min-height: 100vh;
      box-shadow: var(--shadow);
      padding-bottom: 20px;
      position: relative;
    }
    .topbar {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 12px 0 0 0;
      position: relative;
    }
    .settings-btn {
      position: absolute;
      left: 18px;
      top: 8px;
      background: none;
      border: none;
      font-size: 1.6em;
      color: var(--primary);
      cursor: pointer;
      z-index: 2;
      padding: 6px;
      border-radius: 8px;
      transition: background 0.2s;
    }
    .settings-btn:active, .settings-btn:focus {
      background: var(--card);
    }
    .app-title {
      font-size: 1.5em;
      font-weight: bold;
      letter-spacing: 1px;
      color: var(--primary);
      margin: 0 auto;
      user-select: none;
      font-family: 'Segoe UI', Arial, sans-serif;
    }
    .header-nav {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin: 18px 12px 0 12px;
    }
    .nav-btn {
      background: var(--primary);
      color: #fff;
      border: none;
      border-radius: 7px;
      font-size: 1.2em;
      width: 32px;
      height: 32px;
      cursor: pointer;
      transition: background 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .nav-btn:active {
      background: var(--accent);
    }
    .header-date {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 2px;
      font-size: 1.05em;
    }
    .budget-section {
      margin: 18px 0 8px 0;
      text-align: center;
    }
    .budget-section input[type="number"] {
      width: 100px;
      padding: 6px;
      border-radius: 7px;
      border: 1px solid #c7d2fe;
      font-size: 1.07em;
      margin-left: 7px;
      background: var(--card);
      color: var(--text);
      transition: border 0.2s;
    }
    .budget-section input[type="number"]:focus {
      border: 1.5px solid var(--primary);
      outline: none;
    }
    .budget-section button {
      background: var(--primary);
      color: #fff;
      border: none;
      border-radius: 7px;
      padding: 6px 16px;
      margin-left: 7px;
      font-size: 1.07em;
      cursor: pointer;
      transition: background 0.2s;
    }
    .budget-section button:active {
      background: var(--accent);
    }
    .calendar-card {
      background: var(--card);
      border-radius: 16px;
      margin: 0 10px 12px 10px;
      box-shadow: var(--shadow);
      padding: 10px 0 0 0;
    }
    .calendar {
      width: 100%;
      border-collapse: collapse;
      background: transparent;
      border-radius: 16px;
      overflow: hidden;
      font-size: 1.07em;
      user-select: none;
    }
    .calendar th, .calendar td {
      width: 14.2%;
      text-align: center;
      padding: 8px 0;
      border: none;
    }
    .calendar th {
      color: var(--primary);
      font-weight: 600;
      font-size: 1.02em;
      background: none;
    }
    .calendar td {
      cursor: pointer;
      background: none;
      transition: background 0.18s, color 0.18s;
      border-radius: 50%;
      position: relative;
      font-weight: 500;
    }
    .calendar td.today {
      background: var(--primary);
      color: #fff;
    }
    .calendar td.selected {
      background: var(--accent);
      color: #fff;
    }
    .calendar td.has-expense::after {
      content: '';
      display: block;
      margin: 0 auto;
      margin-top: 3px;
      width: 7px;
      height: 7px;
      border-radius: 50%;
      background: var(--accent);
    }
    .summary-section {
      margin: 12px 0 8px 0;
      text-align: center;
      font-size: 1.07em;
      background: var(--card);
      border-radius: 12px;
      box-shadow: var(--shadow);
      padding: 8px 0 4px 0;
      display: flex;
      justify-content: center;
      gap: 24px;
    }
    .summary-section span {
      color: var(--primary);
    }
    .pie-chart-section {
      background: var(--card);
      border-radius: 16px;
      margin: 10px 10px 0 10px;
      padding: 12px 0 0 0;
      text-align: center;
      box-shadow: var(--shadow);
      position: relative;
    }
    .pie-legend {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      margin-top: 8px;
      gap: 8px;
    }
    .pie-legend-item {
      display: flex;
      align-items: center;
      font-size: 0.97em;
      background: var(--bg);
      border-radius: 7px;
      padding: 3px 9px 3px 4px;
      box-shadow: 0 1px 3px #6366f11a;
      margin-bottom: 3px;
    }
    .pie-legend-color {
      width: 15px;
      height: 15px;
      border-radius: 4px;
      margin-right: 6px;
      display: inline-block;
    }
    .powered {
      margin-top: 20px;
      text-align: center;
      color: var(--primary);
      font-weight: bold;
      font-size: 1.08em;
      letter-spacing: 1px;
      padding-bottom: 20px;
      user-select: none;
    }
    /* Tooltip */
    #chartTooltip {
      position: absolute;
      pointer-events: none;
      background: rgba(0,0,0,0.75);
      color: white;
      padding: 6px 10px;
      border-radius: 6px;
      font-size: 0.9em;
      visibility: hidden;
      z-index: 1000;
      white-space: nowrap;
      opacity: 0;
      transition: opacity 0.15s ease-in-out;
      transform: translate(-50%, -110%);
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
      user-select: none;
      max-width: 180px;
      text-align: center;
    }
    /* Modal styles */
    .modal-overlay {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.18);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 100;
      animation: fadeIn 0.2s;
    }
    .modal {
      background: var(--card);
      padding: 20px 16px 12px 16px;
      border-radius: 18px;
      box-shadow: var(--shadow);
      min-width: 270px;
      max-width: 92vw;
      max-height: 90vh;
      overflow-y: auto;
      position: relative;
      animation: popIn 0.18s;
    }
    .modal-close {
      position: absolute;
      top: 12px;
      right: 15px;
      font-size: 1.3em;
      background: none;
      border: none;
      color: var(--primary);
      cursor: pointer;
      z-index: 2;
    }
    .modal h3 {
      margin: 0 0 10px 0;
      font-size: 1.13em;
      color: var(--primary);
      text-align: center;
    }
    .modal .about-text {
      color: var(--text);
      font-size: 1.03em;
      margin-bottom: 10px;
      text-align: left;
      line-height: 1.45;
    }
    .modal .contact-email {
      font-size: 1.05em;
      color: var(--accent);
      margin-bottom: 8px;
      text-align: center;
      word-break: break-all;
    }
    .modal .theme-toggle-btn {
      display: flex;
      align-items: center;
      gap: 8px;
      background: var(--primary);
      color: #fff;
      border: none;
      border-radius: 7px;
      padding: 8px 16px;
      font-size: 1.07em;
      cursor: pointer;
      margin: 8px auto 0 auto;
      transition: background 0.2s;
      justify-content: center;
    }
    .modal .theme-toggle-btn:active {
      background: var(--accent);
    }
    .modal-menu {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin: 12px 0 0 0;
    }
    .modal-menu button {
      background: var(--primary);
      color: #fff;
      border: none;
      border-radius: 7px;
      padding: 10px 0;
      font-size: 1.08em;
      cursor: pointer;
      transition: background 0.2s;
    }
    .modal-menu button:active {
      background: var(--accent);
    }
    /* Expense Modal */
    .expense-modal .modal {
      min-width: 270px;
      max-width: 92vw;
      padding-bottom: 10px;
    }
    .add-expense-form {
      display: flex;
      gap: 6px;
      margin-bottom: 8px;
      margin-top: 6px;
    }
    .add-expense-form input[type="text"] {
      width: 80px;
      padding: 5px 7px;
      border-radius: 6px;
      border: 1px solid #c7d2fe;
      font-size: 1em;
      background: var(--bg);
      color: var(--text);
    }
    .add-expense-form input[type="number"] {
      width: 60px;
      padding: 5px 7px;
      border-radius: 6px;
      border: 1px solid #c7d2fe;
      font-size: 1em;
      background: var(--bg);
      color: var(--text);
    }
    .add-expense-form button {
      background: var(--accent);
      color: #fff;
      border: none;
      border-radius: 6px;
      padding: 5px 12px;
      font-size: 1em;
      cursor: pointer;
      transition: background 0.2s;
    }
    .add-expense-form button:active {
      background: var(--primary);
    }
    .expense-list {
      max-height: 120px;
      overflow-y: auto;
      margin-bottom: 8px;
    }
    .expense-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 3px 0;
      border-bottom: 1px dashed #e0e7ff;
      font-size: 0.97em;
      color: var(--text);
    }
    .expense-item:last-child {
      border-bottom: none;
    }
    .delete-btn {
      background: var(--danger);
      color: #fff;
      border: none;
      border-radius: 5px;
      font-size: 0.93em;
      padding: 2px 7px;
      cursor: pointer;
      margin-left: 8px;
      transition: background 0.2s;
    }
    .delete-btn:active {
      background: #b91c1c;
    }
    .expense-modal .modal {
      padding-bottom: 10px;
    }
    .expense-modal .modal h3 {
      margin-bottom: 6px;
    }
    .expense-modal .modal .add-expense-form {
      margin-bottom: 6px;
    }
    /* Animations */
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    @keyframes popIn {
      from { transform: scale(0.97); opacity: 0.7;}
      to { transform: scale(1); opacity: 1;}
    }
    @media (max-width: 480px) {
      .app-container { padding-bottom: 12px; }
      .calendar-card, .pie-chart-section { margin: 0 2px 10px 2px; }
      .summary-section { gap: 10px; }
      .modal { min-width: 90vw; }
      .pie-legend { flex-direction: column; align-items: flex-start; }
    }
  </style>
</head>
<body>
  <div class="app-container" id="appContainer">
    <div class="topbar">
      <button class="settings-btn" id="settingsBtn" aria-label="Settings">&#9881;</button>
      <span class="app-title">WalletWhiz</span>
    </div>
    <div class="header-nav">
      <button class="nav-btn" id="prevYear" aria-label="Previous Year">&#8592;</button>
      <div class="header-date">
        <span id="yearDisplay"></span>
        <div style="display:flex;align-items:center;gap:5px;">
          <button class="nav-btn" id="prevMonth" aria-label="Previous Month" style="font-size:1.1em;">&#8592;</button>
          <span id="monthDisplay"></span>
          <button class="nav-btn" id="nextMonth" aria-label="Next Month" style="font-size:1.1em;">&#8594;</button>
        </div>
      </div>
      <button class="nav-btn" id="nextYear" aria-label="Next Year">&#8594;</button>
    </div>
    <div class="budget-section">
      <label for="budgetInput"><b>Budget:</b></label>
      <input type="number" id="budgetInput" min="0" step="1" />
      <button id="saveBudgetBtn">Save</button>
    </div>
    <div class="calendar-card">
      <table class="calendar" id="calendar"></table>
    </div>
    <div class="summary-section">
      <span><b>Spent:</b> ₹<span id="spentAmount">0</span></span>
      <span><b>Remaining:</b> ₹<span id="remainingAmount">0</span></span>
    </div>
    <div class="pie-chart-section">
      <canvas id="pieChart" width="280" height="220"></canvas>
      <div class="pie-legend" id="pieLegend"></div>
      <div id="chartTooltip"></div>
    </div>
    <div class="powered">Powered by BHV Technologies</div>
  </div>

  <!-- Expense Modal -->
  <div id="expenseModal" class="modal-overlay" style="display:none;">
    <div class="modal">
      <button class="modal-close" id="closeModalBtn">&times;</button>
      <h3>Expenses for <span id="modalDate"></span></h3>
      <form class="add-expense-form" id="addExpenseForm">
        <input type="text" id="expenseTitle" placeholder="Title" maxlength="18" required />
        <input type="number" id="expenseAmount" placeholder="₹" min="1" required />
        <button type="submit">Add</button>
      </form>
      <div class="expense-list" id="expenseList"></div>
      <div style="text-align:right;font-size:1em;">
        <b>Total:</b> ₹<span id="dayTotal">0</span>
      </div>
    </div>
  </div>

  <!-- Settings Modal -->
  <div id="settingsModal" class="modal-overlay" style="display:none;">
    <div class="modal">
      <button class="modal-close" id="closeSettingsBtn">&times;</button>
      <h3>Settings</h3>
      <div class="modal-menu">
        <button id="themeToggleBtn"><span id="themeIcon">&#9788;</span> Change Theme</button>
        <button id="aboutBtn">About Us</button>
        <button id="contactBtn">Contact Us</button>
      </div>
    </div>
  </div>

  <!-- About Modal -->
  <div id="aboutModal" class="modal-overlay" style="display:none;">
    <div class="modal">
      <button class="modal-close" id="closeAboutBtn">&times;</button>
      <h3>About Us</h3>
      <div class="about-text">
        At BHV Technologies, we believe that technology should be accessible to everyone. Our mission is to break down barriers and make powerful digital tools available to all, regardless of background or resources. Through innovation, simplicity, and inclusivity, we develop intelligent solutions that empower users and transform how knowledge is shared, learned, and applied.<br /><br />
        Join us in building a future where technology serves everyone equally.
      </div>
    </div>
  </div>

  <!-- Contact Modal -->
  <div id="contactModal" class="modal-overlay" style="display:none;">
    <div class="modal">
      <button class="modal-close" id="closeContactBtn">&times;</button>
      <h3>Contact Us</h3>
      <div class="contact-email">
        <b>Email:</b> bhvtechnologies2007@gmail.com
      </div>
    </div>
  </div>

  <script>
    const monthNames = [
      "January", "February", "March", "April", "May", "June",
      "July", "August", "September", "October", "November", "December"
    ];
    let today = new Date();
    let currentYear = today.getFullYear();
    let currentMonth = today.getMonth();
    let selectedDay = null;

    const yearDisplay = document.getElementById("yearDisplay");
    const monthDisplay = document.getElementById("monthDisplay");
    const calendar = document.getElementById("calendar");
    const budgetInput = document.getElementById("budgetInput");
    const saveBudgetBtn = document.getElementById("saveBudgetBtn");
    const spentAmount = document.getElementById("spentAmount");
    const remainingAmount = document.getElementById("remainingAmount");
    const pieChart = document.getElementById("pieChart");
    const pieLegend = document.getElementById("pieLegend");
    const tooltip = document.getElementById("chartTooltip");

    const expenseModal = document.getElementById("expenseModal");
    const closeModalBtn = document.getElementById("closeModalBtn");
    const modalDate = document.getElementById("modalDate");
    const addExpenseForm = document.getElementById("addExpenseForm");
    const expenseTitle = document.getElementById("expenseTitle");
    const expenseAmount = document.getElementById("expenseAmount");
    const expenseList = document.getElementById("expenseList");
    const dayTotal = document.getElementById("dayTotal");

    const settingsBtn = document.getElementById("settingsBtn");
    const settingsModal = document.getElementById("settingsModal");
    const closeSettingsBtn = document.getElementById("closeSettingsBtn");
    const themeToggleBtn = document.getElementById("themeToggleBtn");
    const themeIcon = document.getElementById("themeIcon");
    const aboutBtn = document.getElementById("aboutBtn");
    const contactBtn = document.getElementById("contactBtn");
    const aboutModal = document.getElementById("aboutModal");
    const closeAboutBtn = document.getElementById("closeAboutBtn");
    const contactModal = document.getElementById("contactModal");
    const closeContactBtn = document.getElementById("closeContactBtn");

    let slices = [];

    function getMonthKey(year, month) {
      return `expenses_${year}_${month}`;
    }
    function loadMonthData(year, month) {
      const key = getMonthKey(year, month);
      const data = localStorage.getItem(key);
      return data ? JSON.parse(data) : { budget: 0, expenses: {} };
    }
    function saveMonthData(year, month, data) {
      const key = getMonthKey(year, month);
      localStorage.setItem(key, JSON.stringify(data));
    }

    function renderHeader() {
      yearDisplay.textContent = currentYear;
      monthDisplay.textContent = monthNames[currentMonth];
    }
    function renderBudget() {
      const data = loadMonthData(currentYear, currentMonth);
      budgetInput.value = data.budget || "";
    }
    function renderSummary() {
      const data = loadMonthData(currentYear, currentMonth);
      let totalSpent = 0;
      Object.values(data.expenses).forEach(dayArr => {
        totalSpent += dayArr.reduce((sum, e) => sum + e.amount, 0);
      });
      spentAmount.textContent = totalSpent;
      remainingAmount.textContent = Math.max((data.budget || 0) - totalSpent, 0);
    }
    function renderCalendar() {
      const data = loadMonthData(currentYear, currentMonth);
      calendar.innerHTML = "";
      const firstDay = new Date(currentYear, currentMonth, 1).getDay();
      const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
      const weekDays = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
      let html = '<tr>';
      weekDays.forEach(d => html += `<th>${d}</th>`);
      html += '</tr><tr>';
      let day = 1;
      for(let i=0; i<firstDay; i++) html += '<td></td>';
      for(let i=firstDay; i<7; i++) {
        html += dayCell(day++, data);
      }
      html += '</tr>';
      while(day <= daysInMonth) {
        html += '<tr>';
        for(let i=0; i<7; i++) {
          if(day > daysInMonth) html += '<td></td>';
          else html += dayCell(day++, data);
        }
        html += '</tr>';
      }
      calendar.innerHTML = html;
      Array.from(calendar.querySelectorAll('td[data-day]')).forEach(td => {
        td.onclick = () => openExpenseModal(parseInt(td.dataset.day));
      });
    }
    function dayCell(day, data) {
      let classes = [];
      const isToday = (currentYear === today.getFullYear() && currentMonth === today.getMonth() && day === today.getDate());
      if(isToday) classes.push('today');
      if(selectedDay === day) classes.push('selected');
      if(data.expenses[day] && data.expenses[day].length) classes.push('has-expense');
      return `<td data-day="${day}" class="${classes.join(' ')}">${day}</td>`;
    }

    function renderPieChart() {
      const ctx = pieChart.getContext('2d');
      const data = loadMonthData(currentYear, currentMonth);

      const reasonTotals = {};
      Object.values(data.expenses).forEach(dayArr => {
        dayArr.forEach(e => {
          let key = e.title.trim() || "Other";
          reasonTotals[key] = (reasonTotals[key] || 0) + e.amount;
        });
      });

      const reasons = Object.keys(reasonTotals);
      const values = reasons.map(r => reasonTotals[r]);
      const total = values.reduce((a,b) => a+b, 0);

      const colors = [
        '#6366f1','#f59e42','#10b981','#ef4444','#fbbf24','#3b82f6','#a78bfa','#6ee7b7','#f472b6','#f87171','#facc15','#60a5fa','#c026d3'
      ];

      pieLegend.innerHTML = '';
      slices = [];

      if(total === 0) {
        ctx.clearRect(0,0,pieChart.width,pieChart.height);
        ctx.fillStyle = "#d1d5db";
        ctx.beginPath();
        ctx.arc(140,110,100,0,2*Math.PI);
        ctx.fill();
        ctx.fillStyle = "#6366f1";
        ctx.font = "bold 18px Segoe UI";
        ctx.textAlign = "center";
        ctx.fillText("No Expenses",140,115);
        return;
      }

      reasons.forEach((reason, i) => {
        const percent = ((values[i]/total)*100).toFixed(1);
        const div = document.createElement('div');
        div.className = "pie-legend-item";
        div.innerHTML = `<span class="pie-legend-color" style="background:${colors[i % colors.length]}"></span>
          <span title="${reason}">${reason.length > 14 ? reason.slice(0, 13) + '…' : reason}</span>
          &nbsp;<b>₹${values[i]}</b> <span style="color:var(--primary);font-size:0.93em;">(${percent}%)</span>`;
        pieLegend.appendChild(div);
      });

      const centerX = 140;
      const centerY = 110;
      const radius = 100;
      const innerRadius = 50;

      let animationStartTime = null;
      const animationDuration = 1000;

      function easeOutCubic(t) {
        return 1 - Math.pow(1 - t, 3);
      }

      function animate(timestamp) {
        if (!animationStartTime) animationStartTime = timestamp;
        const elapsed = timestamp - animationStartTime;
        const progress = Math.min(elapsed / animationDuration, 1);
        const easedProgress = easeOutCubic(progress);

        ctx.clearRect(0, 0, pieChart.width, pieChart.height);

        let startAngle = -Math.PI / 2;
        slices = [];

        for (let i = 0; i < reasons.length; i++) {
          const sliceAngle = (values[i] / total) * 2 * Math.PI;
          const drawAngle = sliceAngle * easedProgress;

          if (drawAngle > 0) {
            ctx.beginPath();
            ctx.moveTo(centerX, centerY);
            ctx.arc(centerX, centerY, radius, startAngle, startAngle + drawAngle);
            ctx.arc(centerX, centerY, innerRadius, startAngle + drawAngle, startAngle, true);
            ctx.closePath();
            ctx.fillStyle = colors[i % colors.length];
            ctx.fill();

            slices.push({
              startAngle: startAngle,
              endAngle: startAngle + drawAngle,
              label: reasons[i],
              value: values[i],
              percent: ((values[i] / total) * 100).toFixed(1),
              color: colors[i % colors.length]
            });
          }
          startAngle += sliceAngle;
        }

        ctx.beginPath();
        ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--bg').trim() || '#fff';
        ctx.arc(centerX, centerY, innerRadius, 0, 2 * Math.PI);
        ctx.fill();

        if (progress < 1) {
          requestAnimationFrame(animate);
        }
      }

      requestAnimationFrame(animate);
    }

    pieChart.addEventListener('mousemove', e => {
      const rect = pieChart.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;
      const centerX = 140;
      const centerY = 110;
      const dx = x - centerX;
      const dy = y - centerY;
      const distance = Math.sqrt(dx * dx + dy * dy);
      const radius = 100;
      const innerRadius = 50;
      if (distance < innerRadius || distance > radius) {
        tooltip.style.visibility = 'hidden';
        tooltip.style.opacity = '0';
        return;
      }
      let angle = Math.atan2(dy, dx);
      if (angle < -Math.PI / 2) angle += 2 * Math.PI;

      for (const slice of slices) {
        if (angle >= slice.startAngle && angle <= slice.endAngle) {
          const midAngle = (slice.startAngle + slice.endAngle) / 2;
          const tooltipRadius = radius + 15;
          const tooltipX = centerX + tooltipRadius * Math.cos(midAngle);
          const tooltipY = centerY + tooltipRadius * Math.sin(midAngle);

          const containerRect = pieChart.parentElement.getBoundingClientRect();
          tooltip.style.left = (tooltipX + containerRect.left - window.pageXOffset) + 'px';
          tooltip.style.top = (tooltipY + containerRect.top - window.pageYOffset) + 'px';

          tooltip.style.visibility = 'visible';
          tooltip.style.opacity = '1';
          tooltip.innerHTML = `
            <span style="display:inline-block;width:12px;height:12px;background:${slice.color};border-radius:3px;margin-right:6px;vertical-align:middle;"></span>
            <strong>${slice.label}</strong><br>
            ₹${slice.value} (${slice.percent}%)
          `;
          return;
        }
      }
      tooltip.style.visibility = 'hidden';
      tooltip.style.opacity = '0';
    });
    pieChart.addEventListener('mouseleave', () => {
      tooltip.style.visibility = 'hidden';
      tooltip.style.opacity = '0';
    });

    // Expense modal functions
    function openExpenseModal(day) {
      selectedDay = day;
      renderCalendar();
      expenseModal.style.display = 'flex';
      modalDate.textContent = `${day} ${monthNames[currentMonth]} ${currentYear}`;
      expenseTitle.value = '';
      expenseAmount.value = '';
      renderExpenseList();
    }
    function closeExpenseModal() {
      expenseModal.style.display = 'none';
      selectedDay = null;
      renderCalendar();
    }
    function renderExpenseList() {
      const data = loadMonthData(currentYear, currentMonth);
      const expenses = data.expenses[selectedDay] || [];
      expenseList.innerHTML = '';
      let sum = 0;
      expenses.forEach((e,i) => {
        sum += e.amount;
        const div = document.createElement('div');
        div.className = 'expense-item';
        div.innerHTML = `<span>${e.title} - ₹${e.amount}</span>
          <button class="delete-btn" data-index="${i}">x</button>`;
        expenseList.appendChild(div);
      });
      dayTotal.textContent = sum;
      Array.from(expenseList.querySelectorAll('.delete-btn')).forEach(btn => {
        btn.onclick = () => {
          expenses.splice(btn.dataset.index,1);
          data.expenses[selectedDay] = expenses;
          saveMonthData(currentYear, currentMonth, data);
          renderExpenseList();
          renderCalendar();
          renderSummary();
          renderPieChart();
        };
      });
    }

    addExpenseForm.onsubmit = e => {
      e.preventDefault();
      const title = expenseTitle.value.trim() || 'Other';
      const amount = parseInt(expenseAmount.value);
      if(!amount || amount < 1) return;
      const data = loadMonthData(currentYear, currentMonth);
      if(!data.expenses[selectedDay]) data.expenses[selectedDay] = [];
      data.expenses[selectedDay].push({ title, amount });
      saveMonthData(currentYear, currentMonth, data);
      renderExpenseList();
      renderCalendar();
      renderSummary();
      renderPieChart();
      expenseTitle.value = '';
      expenseAmount.value = '';
    };

    closeModalBtn.onclick = closeExpenseModal;
    expenseModal.onclick = e => { if(e.target === expenseModal) closeExpenseModal(); };

    // Settings modal functions
    function openSettingsModal() {
      settingsModal.style.display = 'flex';
    }
    function closeSettingsModal() {
      settingsModal.style.display = 'none';
    }
    function openAboutModal() {
      aboutModal.style.display = 'flex';
    }
    function closeAboutModal() {
      aboutModal.style.display = 'none';
    }
    function openContactModal() {
      contactModal.style.display = 'flex';
    }
    function closeContactModal() {
      contactModal.style.display = 'none';
    }

    settingsBtn.onclick = openSettingsModal;
    closeSettingsBtn.onclick = closeSettingsModal;
    settingsModal.onclick = e => { if(e.target === settingsModal) closeSettingsModal(); };
    aboutBtn.onclick = () => { closeSettingsModal(); openAboutModal(); };
    closeAboutBtn.onclick = closeAboutModal;
    aboutModal.onclick = e => { if(e.target === aboutModal) closeAboutModal(); };
    contactBtn.onclick = () => { closeSettingsModal(); openContactModal(); };
    closeContactBtn.onclick = closeContactModal;
    contactModal.onclick = e => { if(e.target === contactModal) closeContactModal(); };

    // Theme toggle
    function setTheme(theme) {
      document.documentElement.setAttribute('data-theme', theme);
      localStorage.setItem('ww_theme', theme);
      themeIcon.innerHTML = theme === "dark" ? "&#9790;" : "&#9788;";
    }
    function toggleTheme() {
      let current = document.documentElement.getAttribute('data-theme') || "light";
      setTheme(current === "dark" ? "light" : "dark");
    }
    (function() {
      let saved = localStorage.getItem('ww_theme');
      if(saved) setTheme(saved);
    })();
    themeToggleBtn.onclick = toggleTheme;

    // Navigation buttons
    document.getElementById('prevYear').onclick = () => { currentYear--; renderAll(); };
    document.getElementById('nextYear').onclick = () => { currentYear++; renderAll(); };
    document.getElementById('prevMonth').onclick = () => {
      currentMonth--;
      if(currentMonth < 0) { currentMonth = 11; currentYear--; }
      renderAll();
    };
    document.getElementById('nextMonth').onclick = () => {
      currentMonth++;
      if(currentMonth > 11) { currentMonth = 0; currentYear++; }
      renderAll();
    };
    saveBudgetBtn.onclick = () => {
      let val = parseInt(budgetInput.value) || 0;
      const data = loadMonthData(currentYear, currentMonth);
      data.budget = val;
      saveMonthData(currentYear, currentMonth, data);
      renderSummary();
    };

    // Initial render
    function renderAll() {
      renderHeader();
      renderBudget();
      renderCalendar();
      renderSummary();
      renderPieChart();
    }
    renderAll();
  </script>
</body>
</html>